<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Memory Transport by QTS - Booking System</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            -webkit-tap-highlight-color: transparent;
        }
        body {
            overscroll-behavior: none;
            -webkit-font-smoothing: antialiased;
        }
        .calendar-day { 
            min-height: 80px; 
        }
        input, textarea, select {
            font-size: 16px !important;
        }
        .touch-target {
            min-height: 44px;
        }
        .tier-card {
            transition: all 0.2s;
        }
        .tier-card.selected {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Configuration
        const ADMIN_EMAIL = "memory.transport@qtslimo.com";
        const FROM_NAME = "Memory Transport by QTS";

        const useLocalStorage = (key, initialValue) => {
            const [value, setValue] = useState(() => {
                const stored = localStorage.getItem(key);
                return stored ? JSON.parse(stored) : initialValue;
            });

            useEffect(() => {
                localStorage.setItem(key, JSON.stringify(value));
            }, [key, value]);

            return [value, setValue];
        };

        const PRICING = {
            basic: { price: 35, discount10: 30 },
            premium: { price: 45, discount10: 38 },
            whiteGlove: { price: 60, discount10: 52 }
        };

        function App() {
            const [view, setView] = useState('client');
            const [adminPassword, setAdminPassword] = useState('');
            const [isAdminAuthenticated, setIsAdminAuthenticated] = useState(false);
            const [quotes, setQuotes] = useLocalStorage('memoryTransportQuotes', []);
            const [bookings, setBookings] = useLocalStorage('memoryTransportBookings', []);

            const ADMIN_PASSWORD = 'qts2024';

            return (
                <div className="min-h-screen bg-gray-50">
                    <header className="bg-gradient-to-r from-gray-900 to-gray-800 text-white shadow-lg sticky top-0 z-50">
                        <div className="px-4 py-4">
                            <div className="flex flex-col gap-3">
                                <div>
                                    <h1 className="text-xl sm:text-2xl font-bold">Memory Transport by QTS</h1>
                                    <p className="text-gray-300 text-xs sm:text-sm mt-1">White-Glove Memory Preservation</p>
                                </div>
                                <div className="flex gap-2">
                                    <button
                                        onClick={() => {
                                            setView('client');
                                            setIsAdminAuthenticated(false);
                                        }}
                                        className={`flex-1 touch-target px-4 py-3 rounded-lg font-semibold transition ${view === 'client' ? 'bg-blue-600' : 'bg-gray-700 active:bg-gray-600'}`}
                                    >
                                        Get Quote
                                    </button>
                                    <button
                                        onClick={() => setView('admin')}
                                        className={`flex-1 touch-target px-4 py-3 rounded-lg font-semibold transition ${view === 'admin' ? 'bg-blue-600' : 'bg-gray-700 active:bg-gray-600'}`}
                                    >
                                        Admin
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>

                    <main className="px-4 py-6 pb-20">
                        {view === 'client' ? (
                            <ClientQuoteForm quotes={quotes} setQuotes={setQuotes} />
                        ) : (
                            !isAdminAuthenticated ? (
                                <AdminLogin 
                                    password={adminPassword}
                                    setPassword={setAdminPassword}
                                    setIsAuthenticated={setIsAdminAuthenticated}
                                    correctPassword={ADMIN_PASSWORD}
                                />
                            ) : (
                                <AdminDashboard 
                                    quotes={quotes}
                                    setQuotes={setQuotes}
                                    bookings={bookings}
                                    setBookings={setBookings}
                                />
                            )
                        )}
                    </main>
                </div>
            );
        }

        function ClientQuoteForm({ quotes, setQuotes }) {
            const [formData, setFormData] = useState({
                name: '',
                email: '',
                phone: '',
                tapeCount: '',
                tapeTypes: [],
                tapeCondition: '',
                totalHours: '',
                tier: '',
                customEditing: false,
                rushService: false,
                pickupPreferred: '',
                notes: '',
                referralSource: '',
                submittedAt: ''
            });
            const [submitted, setSubmitted] = useState(false);
            const [showPricing, setShowPricing] = useState(false);

            const tapeTypeOptions = [
                'VHS', 'VHS-C', 'S-VHS', 'MiniDV', 'Mini DVD', 'DVD',
                'Hi8', 'Video8', 'Digital8', 'Betamax'
            ];

            const conditionOptions = ['Good', 'Fair', 'Poor', 'Unknown'];
            
            const referralOptions = [
                'Google Search', 'Facebook', 'Instagram', 'Nextdoor',
                'Fort Worth Moms', 'Friend/Family Referral', 'Repeat Customer', 'Other'
            ];

            const handleSubmit = (e) => {
                e.preventDefault();
                const newQuote = {
                    ...formData,
                    id: Date.now(),
                    submittedAt: new Date().toISOString(),
                    status: 'pending'
                };
                
                // Send emails
                sendQuoteEmails(newQuote);
                
                setQuotes([...quotes, newQuote]);
                setSubmitted(true);
                setTimeout(() => {
                    setSubmitted(false);
                    setFormData({
                        name: '', email: '', phone: '', tapeCount: '', tapeTypes: [],
                        tapeCondition: '', totalHours: '', tier: '', customEditing: false,
                        rushService: false, pickupPreferred: '', notes: '', referralSource: ''
                    });
                }, 3000);
            };

            const sendQuoteEmails = async (quote) => {
                try {
                    // Send admin notification
                    const adminEmailContent = `
New Quote Request Received!

CLIENT INFO:
Name: ${quote.name}
Email: ${quote.email}
Phone: ${quote.phone}

TAPE DETAILS:
Count: ${quote.tapeCount}
Types: ${quote.tapeTypes.join(', ')}
Condition: ${quote.tapeCondition}
Total Hours: ${quote.totalHours || 'Not specified'}

PREFERENCES:
Tier: ${quote.tier || 'Not specified'}
Rush Service: ${quote.rushService ? 'Yes' : 'No'}
Custom Editing: ${quote.customEditing ? 'Yes' : 'No'}
Pickup: ${quote.pickupPreferred || 'Not specified'}

REFERRAL: ${quote.referralSource || 'Not specified'}

NOTES: ${quote.notes || 'None'}

Submitted: ${new Date(quote.submittedAt).toLocaleString()}
                    `;

                    await fetch('/.netlify/functions/send-email', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            to: 'memory.transport@qtslimo.com',
                            subject: `New Quote Request - ${quote.name}`,
                            text: adminEmailContent
                        })
                    });

                    // Send client confirmation
                    const clientEmailContent = `
Hi ${quote.name},

Thank you for choosing Memory Transport by QTS!

We've received your quote request for ${quote.tapeCount} tape(s): ${quote.tapeTypes.join(', ')}.

What happens next:
1. We'll review your request and send a detailed quote within 24 hours
2. Once approved, we'll schedule white-glove pickup
3. Your tapes will be professionally digitized (7-10 business days standard)
4. Digital files and originals delivered back to you

Questions? Reply to this email or call us at (817) 616-0509.

Best regards,
Memory Transport by QTS
memory.transport@qtslimo.com
(817) 616-0509
                    `;

                    await fetch('/.netlify/functions/send-email', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            to: quote.email,
                            subject: 'Quote Request Received - Memory Transport by QTS',
                            text: clientEmailContent
                        })
                    });

                    console.log('Emails sent successfully');
                } catch (error) {
                    console.error('Email send failed:', error);
                    alert('Quote saved! Note: Email notifications may not have sent. Please check your inbox.');
                }
            };

            const handleTapeTypeChange = (type) => {
                setFormData(prev => ({
                    ...prev,
                    tapeTypes: prev.tapeTypes.includes(type)
                        ? prev.tapeTypes.filter(t => t !== type)
                        : [...prev.tapeTypes, type]
                }));
            };

            if (submitted) {
                return (
                    <div className="bg-white rounded-lg shadow-lg p-6 text-center">
                        <div className="text-green-600 text-5xl mb-4">✓</div>
                        <h2 className="text-xl font-bold text-gray-900 mb-3">Quote Request Received!</h2>
                        <p className="text-gray-600 mb-4 text-sm">
                            We'll review your request and get back to you within 24 hours.
                        </p>
                        <p className="text-xs text-gray-500">Confirmation sent to {formData.email}</p>
                    </div>
                );
            }

            return (
                <div>
                    {/* Pricing Tiers Preview */}
                    <div className="mb-6">
                        <button
                            onClick={() => setShowPricing(!showPricing)}
                            className="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg touch-target active:bg-blue-700 transition"
                        >
                            {showPricing ? '▼ Hide Pricing' : '► View Our Pricing Tiers'}
                        </button>
                        
                        {showPricing && (
                            <div className="mt-4 space-y-4">
                                <PricingTierCard 
                                    name="BASIC"
                                    price="$35/tape"
                                    discount="$30/tape for 10+"
                                    items={[
                                        'Standard digitization (720p)',
                                        '15-day download link',
                                        'FREE pickup/delivery (15 miles from 76002)'
                                    ]}
                                />
                                <PricingTierCard 
                                    name="PREMIUM"
                                    price="$45/tape"
                                    discount="$38/tape for 10+"
                                    savings="Save $15"
                                    items={[
                                        'Everything in BASIC, plus:',
                                        '30-day download link (normally +$15)',
                                        'USB drive included (normally +$15)',
                                        'FREE pickup/delivery (20 miles from 76002)'
                                    ]}
                                />
                                <PricingTierCard 
                                    name="WHITE GLOVE"
                                    price="$60/tape"
                                    discount="$52/tape for 10+"
                                    savings="Save $40"
                                    items={[
                                        'Everything in PREMIUM, plus:',
                                        'Lifetime cloud storage (normally +$30)',
                                        'DVD copy included (normally +$5)',
                                        'FREE pickup/delivery (25 miles from 76002)'
                                    ]}
                                    featured={true}
                                />
                            </div>
                        )}
                    </div>

                    <div className="bg-white rounded-lg shadow-lg p-4 sm:p-6">
                        <h2 className="text-xl font-bold text-gray-900 mb-2">Request a Quote</h2>
                        <p className="text-gray-600 mb-6 text-sm">Tell us about your tapes and we'll provide a detailed quote.</p>

                        <form onSubmit={handleSubmit} className="space-y-6">
                            {/* Contact Information */}
                            <div className="space-y-4">
                                <h3 className="font-semibold text-gray-900 text-base">Contact Info</h3>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Full Name *</label>
                                    <input
                                        type="text"
                                        required
                                        value={formData.name}
                                        onChange={(e) => setFormData({...formData, name: e.target.value})}
                                        className="w-full touch-target px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Email *</label>
                                    <input
                                        type="email"
                                        required
                                        value={formData.email}
                                        onChange={(e) => setFormData({...formData, email: e.target.value})}
                                        className="w-full touch-target px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Phone *</label>
                                    <input
                                        type="tel"
                                        required
                                        value={formData.phone}
                                        onChange={(e) => setFormData({...formData, phone: e.target.value})}
                                        className="w-full touch-target px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    />
                                </div>
                            </div>

                            {/* Tape Details */}
                            <div className="space-y-4 pt-4 border-t">
                                <h3 className="font-semibold text-gray-900 text-base">Your Tapes</h3>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Number of tapes *</label>
                                    <input
                                        type="number"
                                        required
                                        min="1"
                                        value={formData.tapeCount}
                                        onChange={(e) => setFormData({...formData, tapeCount: e.target.value})}
                                        className="w-full touch-target px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-3">Tape types (select all that apply) *</label>
                                    <div className="grid grid-cols-2 gap-3">
                                        {tapeTypeOptions.map(type => (
                                            <label key={type} className="flex items-center space-x-3 p-3 border-2 rounded-lg cursor-pointer touch-target active:bg-gray-50 transition"
                                                style={{
                                                    borderColor: formData.tapeTypes.includes(type) ? '#3b82f6' : '#d1d5db',
                                                    backgroundColor: formData.tapeTypes.includes(type) ? '#eff6ff' : 'white'
                                                }}>
                                                <input
                                                    type="checkbox"
                                                    checked={formData.tapeTypes.includes(type)}
                                                    onChange={() => handleTapeTypeChange(type)}
                                                    className="w-5 h-5 text-blue-600 rounded"
                                                />
                                                <span className="text-sm font-medium text-gray-700">{type}</span>
                                            </label>
                                        ))}
                                    </div>
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Condition of tapes *</label>
                                    <select
                                        required
                                        value={formData.tapeCondition}
                                        onChange={(e) => setFormData({...formData, tapeCondition: e.target.value})}
                                        className="w-full touch-target px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    >
                                        <option value="">Select condition</option>
                                        {conditionOptions.map(cond => (
                                            <option key={cond} value={cond}>{cond}</option>
                                        ))}
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Estimated total hours of footage</label>
                                    <input
                                        type="text"
                                        placeholder="e.g., 10 hours"
                                        value={formData.totalHours}
                                        onChange={(e) => setFormData({...formData, totalHours: e.target.value})}
                                        className="w-full touch-target px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    />
                                </div>
                            </div>

                            {/* Service Tier */}
                            <div className="space-y-3 pt-4 border-t">
                                <h3 className="font-semibold text-gray-900 text-base">Preferred Service Tier (optional)</h3>
                                <div className="space-y-3">
                                    {['basic', 'premium', 'whiteGlove', 'recommend'].map(tier => (
                                        <label key={tier} className="flex items-center space-x-3 p-3 border-2 rounded-lg cursor-pointer touch-target active:bg-gray-50 transition"
                                            style={{
                                                borderColor: formData.tier === tier ? '#3b82f6' : '#d1d5db',
                                                backgroundColor: formData.tier === tier ? '#eff6ff' : 'white'
                                            }}>
                                            <input
                                                type="radio"
                                                name="tier"
                                                checked={formData.tier === tier}
                                                onChange={() => setFormData({...formData, tier})}
                                                className="w-5 h-5 text-blue-600"
                                            />
                                            <span className="text-sm font-medium text-gray-700">
                                                {tier === 'basic' && 'Basic ($35/tape)'}
                                                {tier === 'premium' && 'Premium ($45/tape)'}
                                                {tier === 'whiteGlove' && 'White Glove ($60/tape)'}
                                                {tier === 'recommend' && 'Not sure - recommend based on my needs'}
                                            </span>
                                        </label>
                                    ))}
                                </div>
                            </div>

                            {/* Add-Ons */}
                            <div className="space-y-3 pt-4 border-t">
                                <h3 className="font-semibold text-gray-900 text-base">Additional Services</h3>
                                <label className="flex items-start space-x-3 p-4 border-2 rounded-lg cursor-pointer touch-target active:bg-gray-50 transition"
                                    style={{
                                        borderColor: formData.rushService ? '#3b82f6' : '#d1d5db',
                                        backgroundColor: formData.rushService ? '#eff6ff' : 'white'
                                    }}>
                                    <input
                                        type="checkbox"
                                        checked={formData.rushService}
                                        onChange={(e) => setFormData({...formData, rushService: e.target.checked})}
                                        className="mt-1 w-5 h-5 text-blue-600 rounded"
                                    />
                                    <div>
                                        <span className="text-sm font-semibold text-gray-900">Rush Service</span>
                                        <p className="text-xs text-gray-600 mt-1">48-72 hour turnaround (+50% of base price)</p>
                                    </div>
                                </label>
                                <label className="flex items-start space-x-3 p-4 border-2 rounded-lg cursor-pointer touch-target active:bg-gray-50 transition"
                                    style={{
                                        borderColor: formData.customEditing ? '#3b82f6' : '#d1d5db',
                                        backgroundColor: formData.customEditing ? '#eff6ff' : 'white'
                                    }}>
                                    <input
                                        type="checkbox"
                                        checked={formData.customEditing}
                                        onChange={(e) => setFormData({...formData, customEditing: e.target.checked})}
                                        className="mt-1 w-5 h-5 text-blue-600 rounded"
                                    />
                                    <div>
                                        <span className="text-sm font-semibold text-gray-900">Custom Editing/Trimming</span>
                                        <p className="text-xs text-gray-600 mt-1">Contact for pricing - we'll discuss your needs</p>
                                    </div>
                                </label>
                            </div>

                            {/* Pickup */}
                            <div className="space-y-4 pt-4 border-t">
                                <h3 className="font-semibold text-gray-900 text-base">Pickup & Delivery</h3>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Preferred pickup time/location</label>
                                    <textarea
                                        value={formData.pickupPreferred}
                                        onChange={(e) => setFormData({...formData, pickupPreferred: e.target.value})}
                                        rows="2"
                                        placeholder="e.g., Weekday evenings, Fort Worth"
                                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    />
                                    <p className="text-xs text-gray-500 mt-1">
                                        Free pickup within 15-25 miles of 76002 (varies by tier). Contact for quote if beyond.
                                    </p>
                                </div>
                            </div>

                            {/* Referral Source */}
                            <div className="space-y-4 pt-4 border-t">
                                <h3 className="font-semibold text-gray-900 text-base">How did you hear about us?</h3>
                                <select
                                    value={formData.referralSource}
                                    onChange={(e) => setFormData({...formData, referralSource: e.target.value})}
                                    className="w-full touch-target px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                >
                                    <option value="">Select source (optional)</option>
                                    {referralOptions.map(source => (
                                        <option key={source} value={source}>{source}</option>
                                    ))}
                                </select>
                            </div>

                            {/* Notes */}
                            <div className="space-y-4 pt-4 border-t">
                                <label className="block text-sm font-medium text-gray-700 mb-2">Additional notes or special requests</label>
                                <textarea
                                    value={formData.notes}
                                    onChange={(e) => setFormData({...formData, notes: e.target.value})}
                                    rows="3"
                                    placeholder="Special requirements, concerns about tape condition, specific events captured, etc."
                                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                />
                            </div>

                            <button
                                type="submit"
                                className="w-full bg-blue-600 active:bg-blue-700 text-white font-bold py-4 px-6 rounded-lg transition shadow-lg touch-target text-lg"
                            >
                                Request Quote
                            </button>
                        </form>
                    </div>

                    {/* Info Box */}
                    <div className="mt-6 bg-blue-50 border-2 border-blue-200 rounded-lg p-4">
                        <h3 className="font-semibold text-blue-900 mb-3 text-sm">What happens next?</h3>
                        <ol className="space-y-2 text-xs text-blue-800">
                            <li className="flex"><span className="font-bold mr-2">1.</span><span>We review your request and send a detailed quote within 24 hours</span></li>
                            <li className="flex"><span className="font-bold mr-2">2.</span><span>Once approved, we schedule a white-glove pickup</span></li>
                            <li className="flex"><span className="font-bold mr-2">3.</span><span>Your tapes are professionally digitized (7-10 business days standard)</span></li>
                            <li className="flex"><span className="font-bold mr-2">4.</span><span>Digital files and originals delivered back to you</span></li>
                        </ol>
                    </div>
                </div>
            );
        }

        function PricingTierCard({ name, price, discount, savings, items, featured }) {
            return (
                <div className={`p-4 rounded-lg border-2 ${featured ? 'border-blue-500 bg-blue-50' : 'border-gray-300 bg-white'}`}>
                    <div className="flex justify-between items-start mb-2">
                        <h3 className="font-bold text-lg">{name}</h3>
                        {savings && <span className="text-xs bg-green-100 text-green-800 px-2 py-1 rounded font-semibold">{savings}</span>}
                    </div>
                    <p className="text-2xl font-bold text-blue-600 mb-1">{price}</p>
                    <p className="text-xs text-gray-600 mb-3">{discount}</p>
                    <ul className="space-y-1">
                        {items.map((item, i) => (
                            <li key={i} className="text-xs text-gray-700">{item}</li>
                        ))}
                    </ul>
                </div>
            );
        }

        function AdminLogin({ password, setPassword, setIsAuthenticated, correctPassword }) {
            const handleSubmit = (e) => {
                e.preventDefault();
                if (password === correctPassword) {
                    setIsAuthenticated(true);
                } else {
                    alert('Incorrect password');
                }
            };

            return (
                <div>
                    <div className="bg-white rounded-lg shadow-lg p-6">
                        <h2 className="text-xl font-bold text-gray-900 mb-6">Admin Login</h2>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">Password</label>
                                <input
                                    type="password"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    className="w-full touch-target px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                />
                            </div>
                            <button
                                type="submit"
                                className="w-full bg-blue-600 active:bg-blue-700 text-white font-bold py-4 px-6 rounded-lg transition shadow-lg touch-target"
                            >
                                Login
                            </button>
                        </form>
                        <p className="text-xs text-gray-500 mt-4 text-center">Demo password: qts2024</p>
                    </div>
                </div>
            );
        }

        function AdminDashboard({ quotes, setQuotes, bookings, setBookings }) {
            const [activeTab, setActiveTab] = useState('quotes');

            return (
                <div>
                    <div className="mb-4">
                        <div className="flex gap-2 border-b-2">
                            <button
                                onClick={() => setActiveTab('quotes')}
                                className={`flex-1 pb-3 px-4 font-bold transition touch-target ${
                                    activeTab === 'quotes'
                                        ? 'border-b-4 border-blue-600 text-blue-600'
                                        : 'text-gray-600 active:text-gray-900'
                                }`}
                            >
                                Quotes ({quotes.filter(q => q.status === 'pending').length})
                            </button>
                            <button
                                onClick={() => setActiveTab('calendar')}
                                className={`flex-1 pb-3 px-4 font-bold transition touch-target ${
                                    activeTab === 'calendar'
                                        ? 'border-b-4 border-blue-600 text-blue-600'
                                        : 'text-gray-600 active:text-gray-900'
                                }`}
                            >
                                Calendar
                            </button>
                        </div>
                    </div>

                    {activeTab === 'quotes' ? (
                        <QuotesManager quotes={quotes} setQuotes={setQuotes} bookings={bookings} setBookings={setBookings} />
                    ) : (
                        <CalendarView bookings={bookings} setBookings={setBookings} />
                    )}
                </div>
            );
        }

        function QuotesManager({ quotes, setQuotes, bookings, setBookings }) {
            const [selectedQuote, setSelectedQuote] = useState(null);
            const [viewMode, setViewMode] = useState('list');
            const [showQuoteModal, setShowQuoteModal] = useState(false);
            const [quoteData, setQuoteData] = useState({
                basePrice: '',
                quantity: '',
                discount: '',
                rushFee: '',
                customEditingFee: '',
                total: '',
                notes: ''
            });

            const updateQuoteStatus = (quoteId, status) => {
                setQuotes(quotes.map(q => q.id === quoteId ? {...q, status} : q));
            };

            const sendQuoteToClient = async (quote) => {
                const { basePrice, quantity, discount, rushFee, customEditingFee, total, notes } = quoteData;
                
                const subtotal = (parseFloat(basePrice) * parseInt(quantity)).toFixed(2);
                
                const quoteEmailBody = `
Hi ${quote.name},

Here's your custom quote for digitizing ${quote.tapeCount} tape(s) - ${quote.tapeTypes.join(', ')}:

PRICING BREAKDOWN:
Base Price: ${basePrice} × ${quantity} = ${subtotal}
Discount: -${discount || '0.00'}
Rush Service Fee: +${rushFee || '0.00'}
Custom Editing Fee: +${customEditingFee || '0.00'}

TOTAL: ${total}

${notes || 'Thank you for choosing Memory Transport by QTS!'}

Ready to proceed? Reply to this email and we'll schedule pickup!

Best regards,
Memory Transport by QTS
memory.transport.qts@gmail.com
                `;
                
                try {
                    await emailjs.send(EMAILJS_SERVICE_ID, 'template_direct', {
                        to_email: quote.email,
                        from_name: 'Memory Transport by QTS',
                        subject: 'Your Quote from Memory Transport by QTS',
                        message: quoteEmailBody
                    });
                    
                    alert('Quote sent successfully to ' + quote.email);
                    setShowQuoteModal(false);
                    setQuoteData({
                        basePrice: '', quantity: '', discount: '', rushFee: '', 
                        customEditingFee: '', total: '', notes: ''
                    });
                } catch (error) {
                    console.error('Failed to send quote:', error);
                    alert('Failed to send quote. Please try again.');
                }
            };

            const calculateTotal = () => {
                const base = parseFloat(quoteData.basePrice) || 0;
                const qty = parseInt(quoteData.quantity) || 0;
                const disc = parseFloat(quoteData.discount) || 0;
                const rush = parseFloat(quoteData.rushFee) || 0;
                const edit = parseFloat(quoteData.customEditingFee) || 0;
                
                const subtotal = base * qty;
                const total = subtotal - disc + rush + edit;
                
                setQuoteData({...quoteData, total: total.toFixed(2)});
            };

            const convertToBooking = (quote) => {
                const pickupDate = prompt('Enter pickup date (YYYY-MM-DD):');
                if (!pickupDate) return;

                const turnaroundDays = quote.rushService ? 3 : 10;
                const pickupDateObj = new Date(pickupDate);
                const completionDate = new Date(pickupDateObj);
                completionDate.setDate(completionDate.getDate() + turnaroundDays);

                const newBooking = {
                    id: Date.now(),
                    quoteId: quote.id,
                    clientName: quote.name,
                    clientEmail: quote.email,
                    clientPhone: quote.phone,
                    date: pickupDate,
                    completionDate: completionDate.toISOString().split('T')[0],
                    type: 'pickup',
                    tier: quote.tier,
                    tapeCount: quote.tapeCount,
                    tapeTypes: quote.tapeTypes,
                    tapeCondition: quote.tapeCondition,
                    rushService: quote.rushService,
                    customEditing: quote.customEditing,
                    notes: quote.notes,
                    referralSource: quote.referralSource,
                    status: 'pending',
                    paymentStatus: {
                        depositPaid: false,
                        depositAmount: 0,
                        depositMethod: '',
                        depositDate: '',
                        finalPaid: false,
                        finalAmount: 0,
                        finalMethod: '',
                        finalDate: ''
                    },
                    communicationLog: [
                        { date: new Date().toISOString(), note: 'Booking created from quote' }
                    ],
                    internalNotes: ''
                };

                setBookings([...bookings, newBooking]);
                updateQuoteStatus(quote.id, 'booked');
                setViewMode('list');
                alert('✅ Booking created! Remember to export to Google Calendar.');
            };

            const pendingQuotes = quotes.filter(q => q.status === 'pending');
            const otherQuotes = quotes.filter(q => q.status !== 'pending');

            if (viewMode === 'detail' && selectedQuote) {
                return (
                    <div>
                        <button
                            onClick={() => setViewMode('list')}
                            className="mb-4 text-blue-600 font-semibold flex items-center touch-target"
                        >
                            ← Back to Quotes
                        </button>
                        
                        {/* Quote Email Modal */}
                        {showQuoteModal && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                                <div className="bg-white rounded-lg p-6 max-w-md w-full max-h-[90vh] overflow-y-auto">
                                    <h3 className="font-bold text-lg mb-4">Send Quote to {selectedQuote.name}</h3>
                                    
                                    <div className="space-y-3">
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Price per tape ($)</label>
                                            <input
                                                type="number"
                                                step="0.01"
                                                value={quoteData.basePrice}
                                                onChange={(e) => setQuoteData({...quoteData, basePrice: e.target.value})}
                                                className="w-full px-3 py-2 border-2 rounded-lg"
                                                placeholder="35.00"
                                            />
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Quantity</label>
                                            <input
                                                type="number"
                                                value={quoteData.quantity}
                                                onChange={(e) => setQuoteData({...quoteData, quantity: e.target.value})}
                                                className="w-full px-3 py-2 border-2 rounded-lg"
                                                placeholder={selectedQuote.tapeCount}
                                            />
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Discount ($)</label>
                                            <input
                                                type="number"
                                                step="0.01"
                                                value={quoteData.discount}
                                                onChange={(e) => setQuoteData({...quoteData, discount: e.target.value})}
                                                className="w-full px-3 py-2 border-2 rounded-lg"
                                                placeholder="0.00"
                                            />
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Rush Service Fee ($)</label>
                                            <input
                                                type="number"
                                                step="0.01"
                                                value={quoteData.rushFee}
                                                onChange={(e) => setQuoteData({...quoteData, rushFee: e.target.value})}
                                                className="w-full px-3 py-2 border-2 rounded-lg"
                                                placeholder="0.00"
                                            />
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Custom Editing Fee ($)</label>
                                            <input
                                                type="number"
                                                step="0.01"
                                                value={quoteData.customEditingFee}
                                                onChange={(e) => setQuoteData({...quoteData, customEditingFee: e.target.value})}
                                                className="w-full px-3 py-2 border-2 rounded-lg"
                                                placeholder="0.00"
                                            />
                                        </div>
                                        
                                        <div className="border-t pt-3">
                                            <button
                                                onClick={calculateTotal}
                                                className="w-full bg-gray-200 py-2 rounded-lg font-semibold mb-2"
                                            >
                                                Calculate Total
                                            </button>
                                            <div className="bg-blue-50 p-3 rounded-lg">
                                                <label className="block text-sm font-medium mb-1">Total Amount ($)</label>
                                                <input
                                                    type="number"
                                                    step="0.01"
                                                    value={quoteData.total}
                                                    onChange={(e) => setQuoteData({...quoteData, total: e.target.value})}
                                                    className="w-full px-3 py-2 border-2 rounded-lg font-bold text-lg"
                                                    placeholder="0.00"
                                                />
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Additional Notes</label>
                                            <textarea
                                                value={quoteData.notes}
                                                onChange={(e) => setQuoteData({...quoteData, notes: e.target.value})}
                                                rows="3"
                                                className="w-full px-3 py-2 border-2 rounded-lg"
                                                placeholder="Any special terms, timeline, etc."
                                            />
                                        </div>
                                        
                                        <div className="flex gap-2 pt-2">
                                            <button
                                                onClick={() => sendQuoteToClient(selectedQuote)}
                                                className="flex-1 bg-blue-600 text-white py-3 rounded-lg font-bold"
                                            >
                                                Send Quote
                                            </button>
                                            <button
                                                onClick={() => setShowQuoteModal(false)}
                                                className="flex-1 bg-gray-200 py-3 rounded-lg font-bold"
                                            >
                                                Cancel
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                        
                        <div className="bg-white rounded-lg shadow p-4">
                            <h3 className="text-lg font-bold text-gray-900 mb-4">Quote Details</h3>
                            
                            <div className="space-y-4 text-sm">
                                <div>
                                    <label className="text-xs font-bold text-gray-500 uppercase">Client</label>
                                    <p className="font-semibold">{selectedQuote.name}</p>
                                    <p className="text-gray-600">{selectedQuote.email}</p>
                                    <p className="text-gray-600">{selectedQuote.phone}</p>
                                </div>

                                <div className="border-t pt-4">
                                    <label className="text-xs font-bold text-gray-500 uppercase">Tapes</label>
                                    <p className="font-semibold">{selectedQuote.tapeCount} tapes</p>
                                    <p className="text-gray-600">{selectedQuote.tapeTypes.join(', ')}</p>
                                    <p className="text-gray-600">Condition: {selectedQuote.tapeCondition}</p>
                                    {selectedQuote.totalHours && <p className="text-gray-600">{selectedQuote.totalHours} total footage</p>}
                                </div>

                                <div className="border-t pt-4">
                                    <label className="text-xs font-bold text-gray-500 uppercase">Preferred Tier</label>
                                    <p className="font-semibold capitalize">
                                        {selectedQuote.tier === 'whiteGlove' ? 'White Glove' : selectedQuote.tier || 'Not specified'}
                                    </p>
                                </div>

                                <div className="border-t pt-4">
                                    <label className="text-xs font-bold text-gray-500 uppercase">Add-Ons</label>
                                    {selectedQuote.rushService && <p>✓ Rush Service</p>}
                                    {selectedQuote.customEditing && <p>✓ Custom Editing</p>}
                                    {!selectedQuote.rushService && !selectedQuote.customEditing && <p className="text-gray-600">None requested</p>}
                                </div>

                                {selectedQuote.pickupPreferred && (
                                    <div className="border-t pt-4">
                                        <label className="text-xs font-bold text-gray-500 uppercase">Pickup Preferences</label>
                                        <p>{selectedQuote.pickupPreferred}</p>
                                    </div>
                                )}

                                {selectedQuote.referralSource && (
                                    <div className="border-t pt-4">
                                        <label className="text-xs font-bold text-gray-500 uppercase">Referral Source</label>
                                        <p>{selectedQuote.referralSource}</p>
                                    </div>
                                )}

                                {selectedQuote.notes && (
                                    <div className="border-t pt-4">
                                        <label className="text-xs font-bold text-gray-500 uppercase">Notes</label>
                                        <p>{selectedQuote.notes}</p>
                                    </div>
                                )}

                                <div className="border-t pt-4 space-y-3">
                                    {selectedQuote.status === 'pending' && (
                                        <>
                                            <button
                                                onClick={() => setShowQuoteModal(true)}
                                                className="w-full bg-green-600 active:bg-green-700 text-white font-bold py-4 px-4 rounded-lg transition touch-target"
                                            >
                                                Send Quote via Email
                                            </button>
                                            <button
                                                onClick={() => convertToBooking(selectedQuote)}
                                                className="w-full bg-blue-600 active:bg-blue-700 text-white font-bold py-4 px-4 rounded-lg transition touch-target"
                                            >
                                                Convert to Booking
                                            </button>
                                            <button
                                                onClick={() => {
                                                    updateQuoteStatus(selectedQuote.id, 'declined');
                                                    setViewMode('list');
                                                }}
                                                className="w-full bg-gray-200 active:bg-gray-300 text-gray-800 font-bold py-4 px-4 rounded-lg transition touch-target"
                                            >
                                                Mark as Declined
                                            </button>
                                        </>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="space-y-4">
                    <h3 className="font-bold text-gray-900">Pending Quotes</h3>
                    {pendingQuotes.length === 0 ? (
                        <div className="bg-white rounded-lg shadow p-6 text-center text-gray-500 text-sm">
                            No pending quote requests
                        </div>
                    ) : (
                        pendingQuotes.map(quote => (
                            <div
                                key={quote.id}
                                onClick={() => {
                                    setSelectedQuote(quote);
                                    setViewMode('detail');
                                }}
                                className="bg-white rounded-lg shadow p-4 active:bg-gray-50 transition touch-target"
                            >
                                <div className="flex justify-between items-start mb-2">
                                    <div>
                                        <h4 className="font-bold text-gray-900">{quote.name}</h4>
                                        <p className="text-sm text-gray-600">{quote.email}</p>
                                    </div>
                                    <span className="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs font-semibold rounded">
                                        Pending
                                    </span>
                                </div>
                                <div className="text-sm text-gray-700">
                                    <p className="font-medium">{quote.tapeCount} tapes • {quote.tapeTypes.slice(0,2).join(', ')}{quote.tapeTypes.length > 2 ? '...' : ''}</p>
                                    <p className="text-xs text-gray-500 mt-1">
                                        {new Date(quote.submittedAt).toLocaleDateString()} • {quote.referralSource || 'No source'}
                                    </p>
                                </div>
                                <div className="mt-2 text-blue-600 text-sm font-semibold">
                                    Tap to view details →
                                </div>
                            </div>
                        ))
                    )}

                    {otherQuotes.length > 0 && (
                        <>
                            <h3 className="font-bold text-gray-900 mt-6">Previous Quotes</h3>
                            {otherQuotes.map(quote => (
                                <div
                                    key={quote.id}
                                    onClick={() => {
                                        setSelectedQuote(quote);
                                        setViewMode('detail');
                                    }}
                                    className="bg-white rounded-lg shadow p-4 opacity-75 active:opacity-100 transition touch-target"
                                >
                                    <div className="flex justify-between items-start">
                                        <div>
                                            <h4 className="font-bold text-gray-900">{quote.name}</h4>
                                            <p className="text-sm text-gray-600">{quote.email}</p>
                                        </div>
                                        <span className={`px-2 py-1 text-xs font-semibold rounded ${
                                            quote.status === 'booked' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'
                                        }`}>
                                            {quote.status}
                                        </span>
                                    </div>
                                </div>
                            ))}
                        </>
                    )}
                </div>
            );
        }

        function CalendarView({ bookings, setBookings }) {
            const [currentDate, setCurrentDate] = useState(new Date());
            const [selectedBooking, setSelectedBooking] = useState(null);
            const [viewMode, setViewMode] = useState('calendar');

            const getDaysInMonth = (date) => {
                const year = date.getFullYear();
                const month = date.getMonth();
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const daysInMonth = lastDay.getDate();
                const startingDayOfWeek = firstDay.getDay();

                const days = [];
                for (let i = 0; i < startingDayOfWeek; i++) {
                    days.push(null);
                }
                for (let i = 1; i <= daysInMonth; i++) {
                    days.push(new Date(year, month, i));
                }
                return days;
            };

            const getBookingsForDate = (date) => {
                if (!date) return [];
                const dateStr = date.toISOString().split('T')[0];
                return bookings.filter(b => b.date === dateStr);
            };

            const exportToGoogleCalendar = (booking) => {
                const startDate = new Date(booking.date).toISOString().replace(/-|:|\.\d+/g, '');
                const endDate = new Date(new Date(booking.date).getTime() + 3600000).toISOString().replace(/-|:|\.\d+/g, '');
                const details = `Memory Transport Pickup - ${booking.clientName}\nTapes: ${booking.tapeCount}\nPhone: ${booking.clientPhone}`;
                const url = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=Memory Transport Pickup - ${encodeURIComponent(booking.clientName)}&dates=${startDate}/${endDate}&details=${encodeURIComponent(details)}`;
                window.open(url, '_blank');
            };

            const days = getDaysInMonth(currentDate);
            const monthName = currentDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

            if (viewMode === 'detail' && selectedBooking) {
                return <BookingDetail booking={selectedBooking} setBooking={(updated) => {
                    setBookings(bookings.map(b => b.id === updated.id ? updated : b));
                    setSelectedBooking(updated);
                }} onBack={() => setViewMode('calendar')} onDelete={() => {
                    if (confirm('Delete this booking?')) {
                        setBookings(bookings.filter(b => b.id !== selectedBooking.id));
                        setViewMode('calendar');
                    }
                }} onExport={() => exportToGoogleCalendar(selectedBooking)} />;
            }

            return (
                <div>
                    <div className="bg-white rounded-lg shadow">
                        <div className="p-4 border-b flex justify-between items-center">
                            <button
                                onClick={() => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1))}
                                className="px-4 py-2 bg-gray-200 active:bg-gray-300 rounded-lg transition font-bold touch-target"
                            >
                                ←
                            </button>
                            <h3 className="text-base font-bold">{monthName}</h3>
                            <button
                                onClick={() => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1))}
                                className="px-4 py-2 bg-gray-200 active:bg-gray-300 rounded-lg transition font-bold touch-target"
                            >
                                →
                            </button>
                        </div>

                        <div className="p-2">
                            <div className="grid grid-cols-7 gap-1 mb-2">
                                {['S', 'M', 'T', 'W', 'T', 'F', 'S'].map((day, i) => (
                                    <div key={i} className="text-center text-xs font-bold text-gray-700 py-2">
                                        {day}
                                    </div>
                                ))}
                            </div>
                            <div className="grid grid-cols-7 gap-1">
                                {days.map((day, index) => {
                                    const dayBookings = day ? getBookingsForDate(day) : [];
                                    const isToday = day && day.toDateString() === new Date().toDateString();

                                    return (
                                        <div
                                            key={index}
                                            className={`calendar-day border rounded-lg p-1 ${
                                                day ? 'bg-white' : 'bg-gray-50'
                                            } ${isToday ? 'ring-2 ring-blue-500' : ''}`}
                                        >
                                            {day && (
                                                <>
                                                    <div className="text-xs font-bold text-gray-900 mb-1">
                                                        {day.getDate()}
                                                    </div>
                                                    <div className="space-y-1">
                                                        {dayBookings.map(booking => (
                                                            <div
                                                                key={booking.id}
                                                                onClick={() => {
                                                                    setSelectedBooking(booking);
                                                                    setViewMode('detail');
                                                                }}
                                                                className="text-xs bg-blue-100 text-blue-800 p-1 rounded active:bg-blue-200 transition truncate touch-target"
                                                            >
                                                                📦
                                                            </div>
                                                        ))}
                                                    </div>
                                                </>
                                            )}
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    </div>

                    {bookings.filter(b => {
                        const today = new Date().toISOString().split('T')[0];
                        return b.date === today;
                    }).length > 0 && (
                        <div className="mt-4 bg-white rounded-lg shadow p-4">
                            <h3 className="font-bold text-gray-900 mb-3">Today's Bookings</h3>
                            <div className="space-y-2">
                                {bookings.filter(b => {
                                    const today = new Date().toISOString().split('T')[0];
                                    return b.date === today;
                                }).map(booking => (
                                    <div
                                        key={booking.id}
                                        onClick={() => {
                                            setSelectedBooking(booking);
                                            setViewMode('detail');
                                        }}
                                        className="p-3 bg-blue-50 border-2 border-blue-200 rounded-lg active:bg-blue-100 transition touch-target"
                                    >
                                        <p className="font-semibold text-gray-900">{booking.clientName}</p>
                                        <p className="text-sm text-gray-600">{booking.tapeCount} tapes • {booking.tier || 'No tier'}</p>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        function BookingDetail({ booking, setBooking, onBack, onDelete, onExport }) {
            const [editing, setEditing] = useState(false);
            const [formData, setFormData] = useState({...booking});
            const [showPaymentModal, setShowPaymentModal] = useState(null);
            const [newNote, setNewNote] = useState('');

            const saveEdit = () => {
                setBooking(formData);
                setEditing(false);
            };

            const addCommunicationNote = () => {
                if (!newNote.trim()) return;
                const updated = {
                    ...formData,
                    communicationLog: [
                        ...formData.communicationLog,
                        { date: new Date().toISOString(), note: newNote }
                    ]
                };
                setFormData(updated);
                setBooking(updated);
                setNewNote('');
            };

            const recordPayment = (type, method) => {
                const amount = parseFloat(prompt(`Enter ${type} payment amount:`));
                if (!amount) return;

                let finalAmount = amount;
                if (method === 'Credit/Debit Card') {
                    const fee = amount * 0.04;
                    finalAmount = amount + fee;
                    alert(`4% processing fee applied: $${fee.toFixed(2)}\nTotal charged: $${finalAmount.toFixed(2)}`);
                }

                const updated = {
                    ...formData,
                    paymentStatus: {
                        ...formData.paymentStatus,
                        [`${type}Paid`]: true,
                        [`${type}Amount`]: finalAmount,
                        [`${type}Method`]: method,
                        [`${type}Date`]: new Date().toISOString()
                    }
                };
                setFormData(updated);
                setBooking(updated);
                setShowPaymentModal(null);
            };

            return (
                <div>
                    <button onClick={onBack} className="mb-4 text-blue-600 font-semibold flex items-center touch-target">
                        ← Back to Calendar
                    </button>

                    <div className="bg-white rounded-lg shadow p-4 space-y-4">
                        <div className="flex justify-between items-start">
                            <h3 className="text-lg font-bold text-gray-900">Booking Details</h3>
                            <button onClick={() => setEditing(!editing)} className="text-blue-600 font-semibold text-sm">
                                {editing ? 'Cancel' : 'Edit'}
                            </button>
                        </div>

                        {/* Status */}
                        <div>
                            <label className="text-xs font-bold text-gray-500 uppercase block mb-2">Job Status</label>
                            <select
                                value={formData.status}
                                onChange={(e) => {
                                    const updated = {...formData, status: e.target.value};
                                    setFormData(updated);
                                    setBooking(updated);
                                }}
                                className="w-full px-3 py-2 border-2 rounded-lg"
                            >
                                <option value="pending">Pending</option>
                                <option value="in-progress">In Progress</option>
                                <option value="completed">Completed</option>
                            </select>
                        </div>

                        {/* Client Info */}
                        <div className="border-t pt-4">
                            <label className="text-xs font-bold text-gray-500 uppercase">Client</label>
                            {editing ? (
                                <div className="space-y-2 mt-2">
                                    <input type="text" value={formData.clientName} onChange={(e) => setFormData({...formData, clientName: e.target.value})} className="w-full px-3 py-2 border-2 rounded-lg" placeholder="Name" />
                                    <input type="email" value={formData.clientEmail} onChange={(e) => setFormData({...formData, clientEmail: e.target.value})} className="w-full px-3 py-2 border-2 rounded-lg" placeholder="Email" />
                                    <input type="tel" value={formData.clientPhone} onChange={(e) => setFormData({...formData, clientPhone: e.target.value})} className="w-full px-3 py-2 border-2 rounded-lg" placeholder="Phone" />
                                </div>
                            ) : (
                                <>
                                    <p className="font-semibold">{booking.clientName}</p>
                                    <p className="text-sm text-gray-600">{booking.clientEmail}</p>
                                    <p className="text-sm text-gray-600">{booking.clientPhone}</p>
                                </>
                            )}
                        </div>

                        {/* Dates */}
                        <div className="border-t pt-4">
                            <label className="text-xs font-bold text-gray-500 uppercase">Pickup Date</label>
                            {editing ? (
                                <input type="date" value={formData.date} onChange={(e) => setFormData({...formData, date: e.target.value})} className="w-full px-3 py-2 border-2 rounded-lg mt-1" />
                            ) : (
                                <p className="font-semibold">{new Date(booking.date).toLocaleDateString()}</p>
                            )}
                            <label className="text-xs font-bold text-gray-500 uppercase mt-3 block">Expected Completion</label>
                            <p className="text-sm text-gray-600">{new Date(booking.completionDate).toLocaleDateString()}</p>
                            <p className="text-xs text-gray-500">{booking.rushService ? 'Rush: 48-72 hours' : 'Standard: 7-10 business days'}</p>
                        </div>

                        {/* Job Details */}
                        <div className="border-t pt-4">
                            <label className="text-xs font-bold text-gray-500 uppercase">Job Details</label>
                            <p className="text-sm"><strong>Tier:</strong> {booking.tier ? booking.tier.charAt(0).toUpperCase() + booking.tier.slice(1).replace('G', ' G') : 'Not specified'}</p>
                            <p className="text-sm"><strong>Tapes:</strong> {booking.tapeCount} ({booking.tapeTypes?.join(', ')})</p>
                            <p className="text-sm"><strong>Condition:</strong> {booking.tapeCondition}</p>
                            {booking.rushService && <p className="text-sm text-orange-600">⚡ Rush Service</p>}
                            {booking.customEditing && <p className="text-sm text-purple-600">✂️ Custom Editing</p>}
                        </div>

                        {/* Payment Tracking */}
                        <div className="border-t pt-4">
                            <label className="text-xs font-bold text-gray-500 uppercase mb-2 block">Payment Status</label>
                            
                            <div className="space-y-3">
                                <div className="p-3 bg-gray-50 rounded-lg">
                                    <div className="flex justify-between items-center mb-2">
                                        <span className="font-semibold">Deposit (50%)</span>
                                        {booking.paymentStatus.depositPaid ? (
                                            <span className="px-2 py-1 bg-green-100 text-green-800 text-xs rounded font-semibold">Paid</span>
                                        ) : (
                                            <button onClick={() => setShowPaymentModal('deposit')} className="px-3 py-1 bg-blue-600 text-white text-xs rounded font-semibold">Record Payment</button>
                                        )}
                                    </div>
                                    {booking.paymentStatus.depositPaid && (
                                        <div className="text-xs text-gray-600">
                                            <p>${booking.paymentStatus.depositAmount.toFixed(2)} via {booking.paymentStatus.depositMethod}</p>
                                            <p>{new Date(booking.paymentStatus.depositDate).toLocaleDateString()}</p>
                                        </div>
                                    )}
                                </div>

                                <div className="p-3 bg-gray-50 rounded-lg">
                                    <div className="flex justify-between items-center mb-2">
                                        <span className="font-semibold">Final Payment (50%)</span>
                                        {booking.paymentStatus.finalPaid ? (
                                            <span className="px-2 py-1 bg-green-100 text-green-800 text-xs rounded font-semibold">Paid</span>
                                        ) : (
                                            <button onClick={() => setShowPaymentModal('final')} className="px-3 py-1 bg-blue-600 text-white text-xs rounded font-semibold">Record Payment</button>
                                        )}
                                    </div>
                                    {booking.paymentStatus.finalPaid && (
                                        <div className="text-xs text-gray-600">
                                            <p>${booking.paymentStatus.finalAmount.toFixed(2)} via {booking.paymentStatus.finalMethod}</p>
                                            <p>{new Date(booking.paymentStatus.finalDate).toLocaleDateString()}</p>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>

                        {/* Payment Modal */}
                        {showPaymentModal && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                                <div className="bg-white rounded-lg p-6 max-w-sm w-full">
                                    <h3 className="font-bold text-lg mb-4">Record {showPaymentModal} Payment</h3>
                                    <p className="text-sm text-gray-600 mb-4">Select payment method:</p>
                                    <div className="space-y-2">
                                        {['Cash', 'Venmo', 'CashApp', 'Zelle', 'Credit/Debit Card'].map(method => (
                                            <button
                                                key={method}
                                                onClick={() => recordPayment(showPaymentModal, method)}
                                                className="w-full px-4 py-3 bg-blue-600 text-white rounded-lg font-semibold active:bg-blue-700"
                                            >
                                                {method} {method === 'Credit/Debit Card' && '(+4% fee)'}
                                            </button>
                                        ))}
                                        <button onClick={() => setShowPaymentModal(null)} className="w-full px-4 py-3 bg-gray-200 text-gray-800 rounded-lg font-semibold">Cancel</button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Communication Log */}
                        <div className="border-t pt-4">
                            <label className="text-xs font-bold text-gray-500 uppercase mb-2 block">Communication Log</label>
                            <div className="space-y-2 mb-3">
                                {booking.communicationLog.map((log, i) => (
                                    <div key={i} className="text-xs bg-gray-50 p-2 rounded">
                                        <p className="font-semibold">{new Date(log.date).toLocaleDateString()}</p>
                                        <p className="text-gray-600">{log.note}</p>
                                    </div>
                                ))}
                            </div>
                            <div className="flex gap-2">
                                <input
                                    type="text"
                                    value={newNote}
                                    onChange={(e) => setNewNote(e.target.value)}
                                    placeholder="Add note..."
                                    className="flex-1 px-3 py-2 border-2 rounded-lg text-sm"
                                />
                                <button onClick={addCommunicationNote} className="px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold text-sm">Add</button>
                            </div>
                        </div>

                        {/* Internal Notes */}
                        <div className="border-t pt-4">
                            <label className="text-xs font-bold text-gray-500 uppercase mb-2 block">Internal Notes (Private)</label>
                            <textarea
                                value={formData.internalNotes}
                                onChange={(e) => {
                                    const updated = {...formData, internalNotes: e.target.value};
                                    setFormData(updated);
                                    setBooking(updated);
                                }}
                                rows="3"
                                className="w-full px-3 py-2 border-2 rounded-lg text-sm"
                                placeholder="Private notes about this job..."
                            />
                        </div>

                        {/* Client Notes */}
                        {booking.notes && (
                            <div className="border-t pt-4">
                                <label className="text-xs font-bold text-gray-500 uppercase">Client Notes</label>
                                <p className="text-sm text-gray-700">{booking.notes}</p>
                            </div>
                        )}

                        {/* Actions */}
                        <div className="border-t pt-4 space-y-2">
                            {editing && (
                                <button onClick={saveEdit} className="w-full bg-green-600 text-white font-bold py-3 rounded-lg">
                                    Save Changes
                                </button>
                            )}
                            <button onClick={onExport} className="w-full bg-purple-600 text-white font-bold py-3 rounded-lg">
                                Export to Google Calendar
                            </button>
                            <button onClick={onDelete} className="w-full bg-red-600 text-white font-bold py-3 rounded-lg">
                                Delete Booking
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
